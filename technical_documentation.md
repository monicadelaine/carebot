# Carebot Technical Documentation
**Scope:** This document covers the purpose and function of all of the files in this repository that were not automatically generated. This includes all Docker setup files, HTML pages, CSS, the .env file, and Python Django files. It does not include static files, the healthcare resource database, the Pipfile, Python caches, or files automatically generated by Django (like migrations).

```
root
│   .dockerignore
│   .env
|   .gitattributes
|   .gitignore
|   database_dump.sql
|   docker-compose.yml
|   docker-entrypoint.sh
|   Dockerfile
|   modify&extend_documentation.md
|   Pipfile (out of scope)
|   README.md
|   requirements.txt
|   technical_documentation.md
│
└───carebot
│   │   manage.py
│   │
│   └───carebot
│   │   │   __init__.py
│   │   │   asgi.py
│   │   │   settings.py
│   │   │   urls.py
│   │   │   wsgi.py
│   │
│   └───chat
│       │   __init__.py
│       │   admin.py
│       │   apps.py
│       │   forms.py
│       │   models.py
│       │   tests.py
│       │   urls.py
│       │   views.py
|       |
|       └───migrations (contents are out of scope)
|       |   |   ...
|       |
|       └───static
|       |   |
|       |   └───chat
|       |       |   caregiver_connect_icon.svg
|       |       |   chat.js
|       |       |   elderly_person_image.png
|       |       |   home_icon.png
|       |       |   jake.jpg
|       |       |   kittson_short.jpg
|       |       |   q.png
|       |       |   scott.jpg
|       |       |   styles.css
|       |
|       └───templates
|       |   |
|       |   └───chat
|       |       |   about-us.html
|       |       |   chat.html
|       |       |   dashboard.html
|       |       |   deliverables.html
|       |       |   error.html
|       |       |   footer.html
|       |       |   header.html
|       |       |   home.html
```

# /path/to/folder/
**Purpose:** The purpose of the folder.

## /path/to/filename
**Purpose:** The purpose of the file.

| Function Name | Parameters | Return Value | Other Notes |
| ------------- | ---------- | ------------ | ----------- |
|               |            |              |             |

# /
**Purpose:** This is the root of the repository.

## /.dockerignore
**Purpose:** This file tells Docker which files to ignore (i.e.: not to copy to the image). These are mostly machine-generated files like the Python cache.

## /.env
**Purpose:** This file contains the environment variables required to setup the Docker image and run Django. This file must be created manually. It is not included in the repository. This file should **never** be uploaded to any kind of repository for security purposes. Use environment variables and secrets according to best security practices.

| Variable Name | Type       | Value        | Other Notes |
| ------------- | ---------- | ------------ | ----------- |
| OPEN_API_KEY | string | (varies) | This value is provided when you pay OpenAI for an API key. |
| DEBUG | string | True *or* False | [Django documentation](https://docs.djangoproject.com/en/5.0/ref/settings/#debug) |
| INSECURE_FLAG | string | --insecure *or* blank | [Django documentation](https://docs.djangoproject.com/en/5.0/ref/contrib/staticfiles/#cmdoption-runserver-insecure) |
| SECRET_KEY | string | (varies) | [Django documentation](https://docs.djangoproject.com/en/5.0/ref/settings/#secret-key) |

## /.gitattributes
**Purpose:** This file is intended to force Git to use the Unix-style LF file ending for shell scripts, such as docker-entrypoint.

## /.gitignore
**Purpose:** See [Git documentation](https://git-scm.com/docs/gitignore).

## /database_dump.sql
**Purpose:** This is the database dump of healthcare resources that should be loaded when the Docker container is started.

## /docker-compose.yml
**Purpose:** This is the file used by the `docker compose` command when building or starting the container. This includes both the PostGIS and carebot containers. The file relies on the `INSECURE_FLAG` value in `.env`. See the [Docker documentation](https://docs.docker.com/compose/).

## /docker-entrypoint.sh
**Purpose:** See the [Docker documentation](https://docs.docker.com/reference/dockerfile/#entrypoint).

## /Dockerfile
**Purpose:** This is the file Docker uses to set up the image upon build. Ours includes Python, PostgreSQL, and Django, among others. See the [Docker documentation](https://docs.docker.com/reference/dockerfile/).

## /README.md
**Purpose:** This file provides basic setup instructions.

## /requirements.txt
**Purpose:** This file contains the Python dependencies the pipenv will automatically install upon Docker setup. See [pipenv documentation](https://pipenv.pypa.io/en/latest/pipfile.html#importing-from-requirements-txt).

## /technical_documentation.md
**Purpose:** This document covers the purpose and function of all of the files in this repository that were not automatically generated. This includes all Docker setup files, HTML pages, CSS, the .env file, and Python Django files. It does not include static files, the healthcare resource database, the Pipfile, or Python caches.

# /carebot/
**Purpose:** This folder contains the Django project, `carebot`.  It was automatically generated when the Django project was created.

## manage.py
**Purpose:** This file is used by Django to manage the application. See [Django documentation](https://docs.djangoproject.com/en/5.0/ref/django-admin/#django-admin-and-manage-py).

# /carebot/carebot/
**Purpose:** This folder contains files for Django project (not app) management. It was automatically generated when the Django project was created.

## /carebot/carebot/\_\_init\_\_.py
**Purpose:** This file was automatically generated when the Django project was created. It is empty, but it tells Python that the files in this directory should be treated as a package.

## /carebot/carebot/asgi.py
**Purpose:** See [Django documentation](https://docs.djangoproject.com/en/5.0/howto/deployment/asgi/).

## /carebot/carebot/settings.py
**Purpose:** This file contains settings for the Django project. It depends on many environment variables from `.env`. See [Django documentation](https://docs.djangoproject.com/en/5.0/ref/settings/).

## /carebot/carebot/urls.py
**Purpose:** This file contains the url patterns for the Django project. Most of the project's urls are accessed through the `chat` app. See [Django documentation](https://docs.djangoproject.com/en/5.0/topics/http/urls/).

## /carebot/carebot/wsgi.py
**Purpose:** See [Django documentation](https://docs.djangoproject.com/en/5.0/howto/deployment/wsgi/).

# /carebot/chat/
**Purpose:** This folder contains files for Django app `chat` (not project). It was automatically generated when the Django app was created. The `chat` app is the bulk of the Carebot project.

## /carebot/chat/\_\_init\_\_.py
**Purpose:** This file was automatically generated when the Django project was created. It is empty, but it tells Python that the files in this directory should be treated as a package.

## /carebot/chat/admin.py
**Purpose:** This file was automatically generated when the Django app was created. See [Django documentation](https://docs.djangoproject.com/en/5.0/ref/contrib/admin/actions/).

## /carebot/chat/apps.py
**Purpose:** This file was automatically generated when the Django app was created. See [Django documentation](https://docs.djangoproject.com/en/5.0/ref/applications/).

## /carebot/chat/forms.py
**Purpose:** TODO (Scott)

## /carebot/chat/models.py
**Purpose:** TODO (Scott)

## /carebot/chat/tests.py
**Purpose:** TODO (Kittson)

## /carebot/chat/urls.py
**Purpose:** This file contains the url patterns for the `chat` Django app. See [Django documentation](https://docs.djangoproject.com/en/5.0/topics/http/urls/).

## /carebot/chat/views.py
**Purpose:** TODO (Scott)
| Function Name | Parameters | Return Value | Other Notes |
| ------------- | ---------- | ------------ | ----------- |
| storeUserLocation()             | HTTP Request           | JSON Response  | Loads the JSON data from `sendUserLocation()`, stores the user's latitude and longitude in tuple, appends to array `user_coords`. Often raises Exception due to accessing the HTTP Request multiple times. Catches exception and passes. Needs to be stored within external database for persistance of user location data. Planned to be used within the dashboard heatmap to track where most popular queries are coming from.            |
| chat_view()            |  HTTP Request               |   render() HTML page / JSON Reponse   | **Rate Limting:** This main Django view takes advantage of the Django `@ratelimting` decorator to limit users to a certain number of queries/minute. Current rate limiting is set at 10 requests/minute and limits by client IP address. For further Django rate limiting documentation, see [Django Ratelimiting](https://django-ratelimit.readthedocs.io/en/stable/).
| limited_chat_view()    |  HTTP Request, Exception                | render() HTML page / JSON Reponse  | Django view specific to catching the Django rate limiting exception in order to trigger the traditional `error.html` page rather than the 403 Forbidden page. Checks if passed exception is an instance of Ratelimited Exception from the ratelimit.exceptions class. Configured by Middleware and triggered by `RATELIMIT_VIEW` within `settings.py`.               |
| rate_limited_error_view()    |  HTTP Request                |  render() HTML page / JSON Reponse | Django view specific to catching the Django rate limiting exception. Also has commented out functionality to add any rate limited IP addresses to the list of blacklisted IPs to avoid future malicious users. Renders the standard `error.html` view.                |


# /carebot/chat/migrations/
**Purpose:** The files in this folder are used by Django to process changes to models. Its contents were automatically generated when changes were made, but migrations can also be manually created. The specific contents of this folder are out of scope for this documentation. See [Django documentation](https://docs.djangoproject.com/en/5.0/topics/migrations/).

# /carebot/chat/static/
**Purpose:** This folder contains static assets for the Carebot website. See [Django documentation](https://docs.djangoproject.com/en/5.0/howto/static-files/deployment/).

# /carebot/chat/static/chat/
**Purpose:** This folder contains static assets for the `chat` app of Carebot website. See [Django documentation](https://docs.djangoproject.com/en/5.0/howto/static-files/deployment/).

## /carebot/chat/static/chat/caregiver_connect_icon.svg
**Purpose:** This file is an icon used for a link to the Caregiver Connect website from `chat.html`.

## /carebot/chat/static/chat/chat.js
**Purpose:** TODO (Kittson)

| Function Name | Parameters | Return Value | Other Notes |
| ------------- | ---------- | ------------ | ----------- |
| sendUserLocation() | user_latitude, user_longitude | response.json() | Uses AJAX fetch() and HTTP POST methods to send the user coordinates from the frontend to backend. Imported by `chat.html`, called by `getLatLong()`. |   
|                   |               |                       |         

## /carebot/chat/static/chat/elderly_person_image.png
**Purpose:** This file is an eyecatching image used in `home.html`.

## /carebot/chat/static/chat/home_icon.png
**Purpose:** This file is an icon used for a link to `home.html` from `chat.html`.

## /carebot/chat/static/chat/jake.jpg
**Purpose:** This file is an image of Jake Schaefers (B.S. in Computer Science, 2024). Jake is a member of the first Carebot senior design team.

## /carebot/chat/static/chat/kittson_short.jpg
**Purpose:** This file is an image of Kittson Hamill (B.S. in Computer Science, 2024). Kittson is a member of the first Carebot senior design team.

## /carebot/chat/static/chat/q.jpg
**Purpose:** This file is an image of Quillen Flanigan (B.S. in Computer Science, 2024). Quillen is a member of the first Carebot senior design team.

## /carebot/chat/static/chat/scott.jpg
**Purpose:** This file is an image of Scott Ratchford (B.S. in Computer Science, 2024). Scott is a member of the first Carebot senior design team.

## /carebot/chat/static/chat/styles.css
**Purpose:** This file contains nearly all of the CSS styles used throughout the website.

# /carebot/chat/templates/
**Purpose:** This file contains the Django HTML templates for all the webpages in the project. See [Django documentation](https://docs.djangoproject.com/en/5.0/topics/templates/).

# /carebot/chat/templates/chat/
**Purpose:** This file contains the Django HTML templates for all the webpages in the app. See [Django documentation](https://docs.djangoproject.com/en/5.0/topics/templates/).

## /carebot/chat/templates/chat/about-us.html
**Purpose:** This page lists the Carebot team members and their descriptions.

## /carebot/chat/templates/chat/chat.html
**Purpose:** This is the page for chatting with Carebot, the main portion of the project.

TODO (Scott) Input box resizing and suggested message JS
TODO (Kittson) Other JS

| Function Name | Parameters | Return Value | Other Notes |
| ------------- | ---------- | ------------ | ----------- |
| getUserLocation()              | N/A           |  void            | Triggers `navigator.geolocation.GetCurrentPosition()` to ask permission to collect user's location. Calls the `getLatLong()` function and `userError()` as default error function. Initated on window.onload().            |
| getLatLong()                   | user_position           | void             | Collects the user latitude and longitude, calls the AJAX function `sendUserLocation()` to send user location to backend. Called by `getUserLocation()`            |
| userError()                    | Exception e           |  void            | Error function for `navigator.geolocation.GetCurrentPosition()`. Logs if location is not given by user or if process is not supported by current browser.            |
| hideSuggestedMessages()        | N/A           | void             | Changes suggested message button display to none if the chat text box is not empty. Triggered when first message is sent or first suggested message is clicked            |
| sendSuggestedMessage()         | HTML button - suggested message object           | void             | Fills the chat text box with the value from the given suggested message button, sends message and calls `hideSuggestedMessages()`            |
| showPopUpMsg()                 | N/A            |  void            | Toggles the location-info popup when the popup button is clicked. Currently commented out and waiting for more nuanced styling.             |

## /carebot/chat/templates/chat/dashboard.html
**Purpose:** TODO (Kittson)

| Function Name | Parameters | Return Value | Other Notes |
| ------------- | ---------- | ------------ | ----------- |
|               |            |              |             |

## /carebot/chat/templates/chat/deliverables.html
**Purpose:** This page contains deliverables for the Spring 2024 Computer Science senior design Carebot team. The included presentation links are to PowerPoint files on the University of Alabama Sharepoint. The links are viewable by anyone with a UA Microsoft account, but they expire before May 2025. The source code is hosted in a private repository under Scott Ratchford's personal GitHub account.

## /carebot/chat/templates/chat/error.html
**Purpose:** This is the generic error message page. For security purposes, all types of HTTP/HTTPS errors are directed to this page without exposing the specific error to the user.

## /carebot/chat/templates/chat/footer.html
**Purpose:** This Django HTML snippet for a footer is included on many pages in the project. It provides a link to the privacy policy.

## /carebot/chat/templates/chat/header.html
**Purpose:** This Django HTML snippet for a header is included on many pages in the project. It provides links to `home.html` and the Caregiver Connect website.

## /carebot/chat/templates/chat/home.html
**Purpose:** This is the homepage for the Carebot website.
