<!DOCTYPE html>
<html>
<head>
    <title>Chat with Carebot</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'chat/styles.css' %}">
    <meta name="csrf-token" content="{{ csrf_token }}">
</head>
<body>
    <div id="chatbot-container">
        {% include "chat/header.html" %}
        <div id="chat-messages">
            {% for message in chat_history %}
                {% if message.message_type == 0 %}
                <div class="user-message">
                    <p>{{ message.text }}</p>
                </div>
                {% endif %}
                {% if message.message_type == 1 %}
                <div class="ai-message">
                    <p>{{ message.text }}</p>
                </div>
                {% endif %}
                {% if message.message_type == 2 %}
                <div class="system-message">
                    <p>{{ message.text }}</p>
                </div>
                {% endif %}
            {% endfor %}
        </div>
        <form method="post" id="chat-form">
            {% csrf_token %}
            <div class="form-group">
                {{ form.query }}
                <label>
                   <!-- <input type="checkbox" name="is_sql" id="is_sql"> This is an SQL query -->
                </label>
                <button type="submit" class="btn-send">Send</button>
            </div>
        </form>
        <div id="loading" style="display: none;">
            <p><span class="dot"></span><span class="dot"></span><span class="dot"></span></p>
        </div>
    </div>
    <script src="{% static 'chat/chat.js' %}"></script>
    <script>
        window.addEventListener('beforeunload', function (e) {
            const csrfToken = getCsrfToken();
            const data = new FormData();
            data.append('csrfmiddlewaretoken', csrfToken);

            // Asynchronously clear the session
            navigator.sendBeacon('/clear-session/', data);
        });
    </script>
        
</body>
</html>
